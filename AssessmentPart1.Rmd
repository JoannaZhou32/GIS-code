---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
library(readr)
library(plotly)
library(maptools)
library(RColorBrewer)
library(classInt)
library(OpenStreetMap)
library(sp)
library(rgeos)
library(tmap)
library(tmaptools)
library(sf)
library(rgdal)
library(geojsonio)
library(ggplot2)
library(methods)
library(shinyjs)
library(ggmap)
library(GISTools)
library(reshape2)
library(dplyr)
library(leaflet)
library(magrittr)
############################################################################
# Import the EU referendum data
EU_data <- read_csv("~/CASA0005/Assessment/EU-referendum-result-data.csv")
class(EU_data)
datatypelist <- data.frame(cbind(lapply(EU_data, class)))

# Select London Borough area
EU_data <- data.frame(EU_data)
EULondonBoroughs_data <- EU_data[grep("^E09", EU_data[,4]),]

# Import a Shapefile stored in a local directory
BoroughMapSF <- read_shape("N:\\CASA0005\\week1\\BoundaryData\\england_lad_2011.shp", as.sf = TRUE)
qtm(BoroughMapSF)
head(BoroughMapSF)

# transfer SF into SP
BoroughMapSP <- as(BoroughMapSF, "Spatial")
class(BoroughMapSP)
head(BoroughMapSP)

# join the data of EULondonBoroughs_data to the @data slot in the BoroughMapSP data frame
# BoroughMapSP@data <- data.frame(BoroughMapSP@data, EULondonBoroughs_data[match(BoroughMapSP@data[,"code"], EULondonBoroughs_data[,"Area_Code"]),])
# head(BoroughMapSP@data)

# join the data of EULondonBoroughs_data in the BoroughMapSF data frame
BoroughDataMap <- append_data(BoroughMapSF, EULondonBoroughs_data, key.shp = "code", key.data = "Area_Code", ignore.duplicates = TRUE)

# add basemap and some other guff
tmap_mode("plot")
london_osm <- read_osm(BoroughDataMap, type = "osm", zoom = NULL)
qtm(london_osm) +
  tm_shape(BoroughDataMap) + 
  tm_polygons("Pct_Leave", 
              style = "jenks",
              palette = "YlGn",
              midpoint = NA,
              title = "Rate per 100 people",
              alpha = 0.5) + 
  tm_compass(position = c("right", "bottom"), type = "8star") + 
  tm_scale_bar(position = c("right", "bottom")) +
  tm_layout(title = "Percentage of Vote Rate of Leave.", 
            legend.position = c("right", "bottom"))

# tmap make a FRICKING INTERACTIVE MAP
tmap_mode("view")
tm_shape(BoroughDataMap) +
  tm_polygons("Pct_Leave", 
              style = "jenks",
              palette = "YlGn",
              midpoint = NA,
              title = "Rate per 100 people",
              alpha = 0.5,
              id = "name") + 
  tm_scale_bar(position = c("right", "bottom")) +
  tm_layout(title = "Percentage of Vote Rate of Leave.") +
  tm_view(view.legend.position = c("right", "bottom"))
``````

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
